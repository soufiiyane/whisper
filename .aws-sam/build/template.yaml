AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: 'Whisper IaC using AWS SAM

  '
Resources:
  createAccountLambdaFunction:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: createAccountLambdaFunction
      Handler: createAccount.lambda_handler
      Runtime: python3.10
      Policies:
      - DynamoDBCrudPolicy:
          TableName:
            Ref: usersDynamoDBTable
      Events:
        createAccountApi:
          Type: Api
          Properties:
            Path: /signup
            Method: post
    Metadata:
      SamResourceId: createAccountLambdaFunction
  publishQuestionLambda:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: publishQuestionLambda
      Handler: publishQuestion.lambda_handler
      Runtime: python3.10
      Policies:
      - DynamoDBCrudPolicy:
          TableName:
            Ref: usersDynamoDBTable
      - DynamoDBCrudPolicy:
          TableName:
            Ref: questionsDynamoDBTable
      Events:
        publishQuestion:
          Type: Api
          Properties:
            Path: /question
            Method: post
    Metadata:
      SamResourceId: publishQuestionLambda
  usersDynamoDBTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: users
      AttributeDefinitions:
      - AttributeName: Id
        AttributeType: S
      - AttributeName: Date
        AttributeType: S
      KeySchema:
      - AttributeName: Id
        KeyType: HASH
      - AttributeName: Date
        KeyType: RANGE
      ProvisionedThroughput:
        ReadCapacityUnits: 5
        WriteCapacityUnits: 5
  questionsDynamoDBTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: questions
      AttributeDefinitions:
      - AttributeName: userName
        AttributeType: S
      KeySchema:
      - AttributeName: userName
        KeyType: HASH
      ProvisionedThroughput:
        ReadCapacityUnits: 5
        WriteCapacityUnits: 5
